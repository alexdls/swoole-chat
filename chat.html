<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>messages like material design - Bootdey.com</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="./static/js/jquery.js"></script>
        <link href="./static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
        <link href="./static/css/chat.css" rel="stylesheet">
    </head>
    <body>
        <div id="chat" class="container bootstrap snippet">
            <div class="tile tile-alt" id="messages-main">
                <div class="ms-menu">
                    <div class="ms-user clearfix">
                        <img src="http://bootdey.com/img/Content/avatar/avatar1.png" alt="" class="img-avatar pull-left">
                        <div>Signed in as <br> m-hollaway@gmail.com</div>
                    </div>

                    <div class="p-15">
                        <div class="dropdown">
                            <a class="btn btn-primary btn-block" href="" data-toggle="dropdown">Messages <i class="caret m-l-5"></i></a>

                            <ul class="dropdown-menu dm-icon w-100">
                                <li><a href=""><i class="fa fa-envelope"></i> Messages</a></li>
                                <li><a href=""><i class="fa fa-users"></i> Contacts</a></li>
                                <li><a href=""><i class="fa fa-format-list-bulleted"> </i>Todo Lists</a></li>
                            </ul>
                        </div>
                    </div>

                    <div id="user-list" class="list-group lg-alt">
                        <a class="list-group-item media" href="">
                            <div class="pull-left">
                                <img src="http://bootdey.com/img/Content/avatar/avatar2.png" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <small class="list-group-item-heading">Davil Parnell</small>
                                <small class="list-group-item-text c-gray">Fierent fastidii recteque ad pro</small>
                            </div>
                        </a>

                        <a class="list-group-item media" href="">
                            <div class="pull-left">
                                <img src="http://bootdey.com/img/Content/avatar/avatar3.png" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <div class="list-group-item-heading">Ann Watkinson</div>
                                <small class="list-group-item-text c-gray">Cum sociis natoque penatibus </small>
                            </div>
                        </a>

                        <a class="list-group-item media" href="">
                            <div class="pull-left">
                                <img src="http://bootdey.com/img/Content/avatar/avatar4.png" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <div class="list-group-item-heading">Marse Walter</div>
                                <small class="list-group-item-text c-gray">Suspendisse sapien ligula</small>
                            </div>
                        </a>

                        <a class="list-group-item media" href="">
                            <div class="lv-avatar pull-left">
                                <img src="http://bootdey.com/img/Content/avatar/avatar5.png" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <div class="list-group-item-heading">Jeremy Robbins</div>
                                <small class="list-group-item-text c-gray">Phasellus porttitor tellus nec</small>
                            </div>
                        </a>

                        <a class="list-group-item media" href="">
                            <div class="lv-avatar pull-left">
                                <img src="http://bootdey.com/img/Content/avatar/avatar6.png" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <div class="list-group-item-heading">Reginald Horace</div>
                                <small class="list-group-item-text c-gray">Quisque consequat arcu eget</small>
                            </div>
                        </a>

                        <a class="list-group-item media" href="">
                            <div class="pull-left">
                                <img src="http://bootdey.com/img/Content/avatar/avatar7.png" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <div class="list-group-item-heading">Shark Henry</div>
                                <small class="list-group-item-text c-gray">Nam lobortis odio et leo maximu</small>
                            </div>
                        </a>

                        <a class="list-group-item media" href="">
                            <div class="pull-left">
                                <img src="http://bootdey.com/img/Content/avatar/avatar1.png" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <div class="list-group-item-heading">Paul Van Dack</div>
                                <small class="list-group-item-text c-gray">Nam posuere purus sed velit auctor sodales</small>
                            </div>
                        </a>

                        <a class="list-group-item media" href="">
                            <div class="lv-avatar pull-left">
                                <img src="http://bootdey.com/img/Content/avatar/avatar2.png" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <div class="list-group-item-heading">James Anderson</div>
                                <small class="list-group-item-text c-gray">Vivamus imperdiet sagittis quam</small>
                            </div>
                        </a>

                        <a class="list-group-item media" href="">
                            <div class="lv-avatar pull-left">
                                <img src="http://bootdey.com/img/Content/avatar/avatar3.png" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <div class="list-group-item-heading">Kane Williams</div>
                                <small class="list-group-item-text c-gray">Suspendisse justo nulla luctus nec</small>
                            </div>
                        </a>
                    </div>


                </div>

                <div class="ms-body">
                    <div class="action-header clearfix">
                        <div class="visible-xs" id="ms-menu-trigger">
                            <i class="fa fa-bars"></i>
                        </div>

                        <div class="pull-left hidden-xs">
                            <img src="http://bootdey.com/img/Content/avatar/avatar2.png" alt="" class="img-avatar m-r-10">
                            <div class="lv-avatar pull-left">

                            </div>
                            <span>David Parbell</span>
                        </div>

                        <ul class="ah-actions actions">
                            <li>
                                <a href="">
                                    <i class="fa fa-trash"></i>
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    <i class="fa fa-check"></i>
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    <i class="fa fa-clock-o"></i>
                                </a>
                            </li>
                            <li class="dropdown">
                                <a href="" data-toggle="dropdown" aria-expanded="true">
                                    <i class="fa fa-sort"></i>
                                </a>

                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li>
                                        <a href="">Latest</a>
                                    </li>
                                    <li>
                                        <a href="">Oldest</a>
                                    </li>
                                </ul>
                            </li>                             
                            <li class="dropdown">
                                <a href="" data-toggle="dropdown" aria-expanded="true">
                                    <i class="fa fa-bars"></i>
                                </a>

                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li>
                                        <a href="">Refresh</a>
                                    </li>
                                    <li>
                                        <a href="">Message Settings</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <div class="msg-content" id="msg-content">
                        <div class="message-feed media" v-for="msg in msgs">
                            <div class="pull-left">
                                <img v-bind:src="msg.avatar" alt="" class="img-avatar">
                            </div>
                            <div class="media-body">
                                <div class="nick">{{msg.nick}}</div>
                                <div class="mf-content">
                                    {{msg.body}}
                                </div>
                                <small class="mf-date"><i class="fa fa-clock-o"></i> {{new Date(parseInt(msg.timestamp) * 1000).toLocaleString().replace(/:\d{1,2}$/,' ')}}</small>
                            </div>
                        </div>
                    </div>
                    <div class="msb-reply">
                        <textarea  placeholder="[Ctrl+enter 发送消息]"></textarea>
                        <button id="send"><i class="fa fa-paper-plane-o"></i></button>
                    </div>
                </div>
            </div>
        </div>
        <script src="./static/bootstrap/js/bootstrap.min.js"></script>
        <script src="./static/vue/vue.min.js"></script>
        <script type="text/javascript">
var msgvm = new Vue({
    el: '#msg-content',
    data: {
        msgs: [
        ],
        computed: {
            // 一个计算属性的 getter
        }
    }
});
$(function () {
    var ws = new WebSocket("ws://192.168.33.10:9502");
    setHeight();
    $(window).bind('resize', function () {
        setHeight();
    });
    $(document).keydown(function (e) {
        if (e.which === 13 && e.ctrlKey) {
            $('#send').trigger('click');
        }
    });
    ws.onopen = function (event) {
        //ws.send("接入服务器");
    };
    ws.onmessage = function (event) {
        console.log(event.data);
        var data = JSON.parse(event.data);
        data.avatar = 'http://chat.dev/resource/avatar/'+data.avatar;
        msgvm.msgs.push(data);
        $('.msg-content').animate({scrollTop: $(".msg-content").get(0).scrollHeight}, 'slow');  //滚动条自动到底部
    };
    $('#send').click(function () {
        var content = $(this).prev().val();
        if (content) {
            ws.send(content);
            $(this).prev().val('');
        }
    });
    if ($('#ms-menu-trigger')[0]) {
        $('body').on('click', '#ms-menu-trigger', function () {
            $('.ms-menu').toggleClass('toggled');
        });
    }
});
function setHeight() {
    $('.ms-body').height($(window).height() - 200);
    $('.ms-menu').height($(window).height() - 67 - 200);
    $('#user-list').height($(window).height() - 67 - 200 - 67 - 62);
    $('.msg-content').height($(window).height() - 60 - 120 - 200);
}
        </script>
    </body>
</html>